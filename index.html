<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Granjas El Toro Lucho</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .alert {
            margin-top: 10px;
            font-weight: bold;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .button-container {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        .product-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-info {
            flex-grow: 1;
        }
    </style>
</head>

<body>
    <h1>Granjas El Toro Lucho</h1>

    <!-- Inicio de sesión -->
    <div class="container" id="loginContainer">
        <h2>Iniciar Sesión</h2>
        <form id="loginForm">
            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" name="email" required>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">Ingresar</button>
        </form>
        <p id="loginMessage" class="alert error"></p>
        <button id="goRegister">¿No tienes cuenta? Regístrate</button>
    </div>

    <!-- Registro -->
    <div class="container hidden" id="registerContainer">
        <h2>Registro</h2>
        <form id="registerForm">
            <label for="regEmail">Correo Electrónico:</label>
            <input type="email" id="regEmail" name="regEmail" required>
            <label for="regPassword">Contraseña:</label>
            <input type="password" id="regPassword" name="regPassword" required>
            <button type="submit">Crear Cuenta</button>
        </form>
        <p id="registerMessage" class="alert success"></p>
        <button id="goLogin">¿Ya tienes cuenta? Inicia Sesión</button>
    </div>

    <!-- Productos -->
    <div class="container hidden" id="productosContainer">
        <h2>Productos para Vacas</h2>
        <div id="productosList"></div>
        <button id="viewCart">Ver Carrito</button>
    </div>

    <!-- Vacas en venta -->
    <div class="container hidden" id="vacasContainer">
        <h2>Vacas en Venta</h2>
        <table id="vacasTable">
            <thead>
                <tr>
                    <th>Vaca</th>
                    <th>Precio</th>
                    <th>Agregar al Carrito</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Carrito -->
    <div class="container hidden" id="carritoContainer">
        <h2>Carrito de Compras</h2>
        <table id="carritoTable">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="total" id="totalContainer">Total: 0</div>
        <div class="button-container">
            <button id="finalizePurchase">Finalizar Compra</button>
            <button id="backToProducts" class="back-button">Volver a Productos</button>
        </div>
        <p id="purchaseMessage" class="alert success"></p>
    </div>

    <script>
        // Manejo del registro y login
        document.getElementById('goRegister').onclick = function () {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('registerContainer').classList.remove('hidden');
        };

        document.getElementById('goLogin').onclick = function () {
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('loginContainer').classList.remove('hidden');
        };

        document.getElementById('loginForm').onsubmit = function (event) {
            event.preventDefault();
            document.getElementById('loginMessage').textContent = 'Inicio de sesión exitoso.';
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('productosContainer').classList.remove('hidden');
            loadProducts();
            loadCows();
        };

        document.getElementById('registerForm').onsubmit = function (event) {
            event.preventDefault();
            document.getElementById('registerMessage').textContent = 'Registro exitoso. Ahora puedes iniciar sesión.';
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('loginContainer').classList.remove('hidden');
        };

        // Función para cargar productos
        async function loadProducts() {
            const productos = [
                { name: 'Alimento para Vacas', price: 8000 },
                { name: 'Heno de Alfalfa', price: 5000 },
                { name: 'Suplemento Mineral', price: 7000 },
                { name: 'Alimento para Vacas Potenciado', price: 10000 },
                { name: 'Fardo De Paja', price: 3000 },
                { name: 'Heno De Pasto', price: 4000 },
                { name: 'Leche', price: 2000 },
                { name: 'Cereal para Ganado', price: 1500 },
                { name: 'Antiparasitario', price: 2500 },
                { name: 'Vacuna Bovino', price: 3500 }
            ];
            const productosList = document.getElementById('productosList');
            productos.forEach(product => {
                const productRow = document.createElement('div');
                productRow.classList.add('product-row');
                productRow.innerHTML = `
                    <div class="product-info">
                        <strong>${product.name}</strong> - ${product.price}
                    </div>
                    <div>
                        <input type="number" min="0" value="0" class="product-quantity" data-name="${product.name}">
                        <button class="add-to-cart">Agregar</button>
                    </div>
                `;
                productosList.appendChild(productRow);
            });

            // Manejar el clic en "Agregar al Carrito"
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
            addToCartButtons.forEach(button => {
                button.onclick = function () {
                    const row = button.closest('.product-row');
                    const productName = row.querySelector('.product-quantity').dataset.name;
                    const quantity = row.querySelector('.product-quantity').value;
                    addToCart(productName, quantity);
                    row.querySelector('.product-quantity').value = 0; // Resetear cantidad a 0
                };
            });
        }

        // Función para cargar vacas
        async function loadCows() {
            const cows = [
                { name: 'Vaca Holstein', price: 3000000 },
                { name: 'Vaca Jersey', price: 2800000 },
                { name: 'Vaca Angus', price: 3200000 },
                { name: 'Vaca Hereford', price: 3100000 },
                { name: 'Vaca Limousin', price: 3500000 },
                { name: 'Vaca Guernsey', price: 3400000 },
                { name: 'Vaca Ayrshire', price: 3300000 }
            ];
            const tbody = document.getElementById('vacasTable').querySelector('tbody');
            cows.forEach(cow => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cow.name}</td>
                    <td>${cow.price}</td>
                    <td><button class="add-cow-to-cart">Agregar</button></td>
                `;
                tbody.appendChild(row);
            });

            // Manejar el clic en "Agregar Vaca al Carrito"
            const addCowToCartButtons = document.querySelectorAll('.add-cow-to-cart');
            addCowToCartButtons.forEach(button => {
                button.onclick = function () {
                    const row = button.closest('tr');
                    const cowName = row.querySelector('td').textContent;
                    const cowPrice = cows.find(c => c.name === cowName).price; // Obtener precio de la vaca
                    addToCart(cowName, 1, cowPrice); // Agregar una vaca al carrito
                };
            });
        }

        // Carrito de compras
        const carrito = [];

        function addToCart(name, quantity, price) {
            quantity = parseInt(quantity);
            if (quantity <= 0) return; // No agregar si la cantidad es 0 o negativa

            const existingProduct = carrito.find(item => item.name === name);
            if (existingProduct) {
                existingProduct.quantity += quantity;
            } else {
                carrito.push({ name, quantity, price: price || 0 }); // Si no hay precio, es un producto normal
            }
            updateCartDisplay();
        }

        // Mostrar carrito
        function updateCartDisplay() {
            const cartTableBody = document.getElementById('carritoTable').querySelector('tbody');
            cartTableBody.innerHTML = ''; // Limpiar el contenido previo

            carrito.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>
                        <input type="number" value="${item.quantity}" min="0" class="cart-quantity" data-index="${index}">
                    </td>
                    <td><button class="remove-from-cart">Eliminar</button></td>
                `;
                cartTableBody.appendChild(row);
            });

            // Manejar cambios en la cantidad
            const quantityInputs = document.querySelectorAll('.cart-quantity');
            quantityInputs.forEach(input => {
                input.onchange = function () {
                    const index = this.dataset.index;
                    const newQuantity = parseInt(this.value);
                    if (newQuantity <= 0) {
                        carrito.splice(index, 1); // Eliminar el producto si la cantidad es 0
                    } else {
                        carrito[index].quantity = newQuantity; // Actualizar cantidad
                    }
                    updateTotal(); // Actualizar total cuando cambia la cantidad
                    updateCartDisplay(); // Actualizar la vista del carrito
                };
            });

            // Manejar el clic en "Eliminar"
            const removeButtons = document.querySelectorAll('.remove-from-cart');
            removeButtons.forEach((button, index) => {
                button.onclick = function () {
                    carrito.splice(index, 1);
                    updateCartDisplay(); // Actualizar la tabla del carrito
                    updateTotal(); // Actualizar total después de eliminar
                };
            });

            updateTotal(); // Actualizar total al mostrar el carrito
        }

        // Actualizar total de la compra
        function updateTotal() {
            let total = 0;
            carrito.forEach(item => {
                total += item.price * item.quantity;
            });
            document.getElementById('totalContainer').textContent = `Total: ${total}`; // Mostrar total sin pesos
        }

        // Volver a la sección de productos
        document.getElementById('backToProducts').onclick = function () {
            document.getElementById('carritoContainer').classList.add('hidden');
            document.getElementById('productosContainer').classList.remove('hidden');
        };

        // Finalizar compra
        document.getElementById('finalizePurchase').onclick = function () {
            if (carrito.length > 0) {
                document.getElementById('purchaseMessage').textContent = 'Compra exitosa. Gracias por su compra!';
                carrito.length = 0; // Vaciar carrito
                updateCartDisplay(); // Actualizar carrito
                updateTotal(); // Actualizar total
            } else {
                alert('El carrito está vacío.');
            }
        };

        // Mostrar vacas
        document.getElementById('viewCart').onclick = function () {
            document.getElementById('productosContainer').classList.add('hidden');
            document.getElementById('carritoContainer').classList.remove('hidden');
        };
    </script>
</body>

</html>
